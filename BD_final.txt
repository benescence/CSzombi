-- NUEVA BASE DE DATOS
drop database if exists revivir;
create database revivir;
use revivir;

-- ESQUEMA ROLES
CREATE TABLE rev_roles (
	ID INT(1),
	descripcion VARCHAR(20) NULL,
	PRIMARY KEY (ID)
);

-- ESQUEMAS USUARIOS
CREATE TABLE rev_usuarios (
	ID INT(10) AUTO_INCREMENT,
	rol INT(1) NOT NULL,
	usuario VARCHAR(50) NOT NULL,
	password VARCHAR(50) NOT NULL,
	PRIMARY KEY (ID),
	FOREIGN KEY (rol) REFERENCES rev_roles(ID)
);

-- ESQUEMAS SECTOR
CREATE TABLE rev_sector (
	ID INT(10) NOT NULL,
	descripcion VARCHAR(20) NOT NULL,
    PRIMARY KEY (ID)
);

-- ESQUEMAS SUBSECTOR
CREATE TABLE rev_subsector (
	ID INT(10) NOT NULL,
	sector INT(10) NOT NULL,
    descripcion VARCHAR(20) NOT NULL,
    PRIMARY KEY (ID),
	FOREIGN KEY (sector) REFERENCES rev_sector(ID)
);

-- ESQUEMAS UBICACIONES
CREATE TABLE rev_ubicaciones (
	ID INT(10) AUTO_INCREMENT,
	subsector INT(10) NOT NULL,
	seccion VARCHAR(10) NULL,
	macizo VARCHAR(10) NULL,
	unidad VARCHAR(10) NULL,
	numero_sepultura VARCHAR(11) NULL,
	sepultura VARCHAR(10) NULL,
	inhumacion VARCHAR(20) NULL,
	nicho VARCHAR(11) NULL,
	fila VARCHAR(11) NULL,
	circ VARCHAR(10) NULL,
	parcela VARCHAR(11) NULL,
	mueble VARCHAR(11) NULL,
	bis_macizo VARCHAR(11) NULL,
	bis VARCHAR(1) NULL,
	otro_cementerio VARCHAR(11) NULL,
	osario VARCHAR(11) NULL,
	vencimiento date,
	PRIMARY KEY (ID),
	FOREIGN KEY (subsector) REFERENCES rev_subsector(ID)
);

-- ESQUEMA TIPO DE FALLECIMIENTO
CREATE TABLE rev_tipo_fallecimiento (
	ID INT(1),
	descripcion VARCHAR(20) NOT NULL,
	PRIMARY KEY (ID)
);

-- ESQUEMAS FALLECIDOS
CREATE TABLE rev_fallecidos (
	ID INT(10) AUTO_INCREMENT,
	tipo_fallecimiento INT(1) NOT NULL,
	ubicacion INT(10) NOT NULL,
	nombre VARCHAR(100) NOT NULL,
	apellido VARCHAR(50) NOT NULL,
	DNI VARCHAR(11) NULL,
	cocheria VARCHAR(20) NULL,
	fecha_fallecimiento DATE NOT NULL,
	PRIMARY KEY (ID),
	FOREIGN KEY (tipo_fallecimiento) REFERENCES rev_tipo_fallecimiento(ID),
	FOREIGN KEY (ubicacion) REFERENCES rev_ubicaciones(ID)
);

-- ESQUEMAS MOVIMIENTOS
CREATE TABLE rev_movimientos (
	ID INT(10) AUTO_INCREMENT,
	fallecido int(10) not null,
	antigua_ubicacion VARCHAR(50) not NULL,
	causa_traslado VARCHAR(50) not NULL,
	observaciones VARCHAR(50) NULL,
	FOREIGN KEY (fallecido) REFERENCES rev_fallecidos(ID),
	PRIMARY KEY (ID)
);

	-- ESQUEMA CLIENTES
CREATE TABLE rev_clientes (
	ID INT(10) AUTO_INCREMENT,
	nombre VARCHAR(100) NOT NULL,
	apellido VARCHAR(50) NOT NULL,
	DNI VARCHAR(10) NULL,
	telefono VARCHAR(20) NULL,
	email VARCHAR(200) NULL,
	PRIMARY KEY (ID)
);

-- ESQUEMAS RESPONSABLES
CREATE TABLE rev_responsables (
	ID INT(10) AUTO_INCREMENT,
	cliente INT(10) NOT NULL,
	fallecido INT(10) NOT NULL,
	observaciones VARCHAR(100) NULL,
	PRIMARY KEY (ID),
	FOREIGN KEY (cliente) REFERENCES rev_clientes(ID),
	FOREIGN KEY (fallecido) REFERENCES rev_fallecidos(ID)
);

-- ESQUEMAS SERVICIOS
CREATE TABLE rev_servicios (
	ID INT(10) AUTO_INCREMENT,
	codigo VARCHAR(50) NULL,
	nombre VARCHAR(30) NULL,
	descripcion VARCHAR(100) NULL,
	importe float(10) NOT NULL,
	historico boolean not null,
	PRIMARY KEY (ID)
);

-- ESQUEMAS CARGOS
CREATE TABLE rev_cargos (
	ID INT(10) AUTO_INCREMENT,
	fallecido INT(10) NOT NULL,
	servicio INT(10) NOT NULL,
	observaciones VARCHAR(100) NULL,
	pagado boolean not null,
	PRIMARY KEY (ID),
	FOREIGN KEY (servicio) REFERENCES rev_servicios(ID),
	FOREIGN KEY (fallecido) REFERENCES rev_fallecidos(ID)
);

-- ESQUEMAS PAGOS
CREATE TABLE rev_pagos (
	ID INT(10) AUTO_INCREMENT,
	cargo INT(10) NOT NULL,
	cliente INT(10) NOT NULL,
	importe INT(10) NOT NULL,
	observaciones VARCHAR(100) NULL,
	fecha DATE NOT NULL,
	PRIMARY KEY (ID),
	FOREIGN KEY (cliente) REFERENCES rev_clientes(ID),
	FOREIGN KEY (cargo) REFERENCES rev_cargos(ID)
);






-- INSERT TIPOS DE FALLECIMIENTO
INSERT INTO rev_tipo_fallecimiento (ID, descripcion) VALUES
(1, "TRAUMATICO"),
(2, "NO TRAUMATICO");

-- INSERT  ROLES
INSERT INTO rev_roles (ID, descripcion) VALUES
(1, "SUPERVISOR"),
(2, "ADMINISTRATIVO");

-- INSERT SECTORES
INSERT INTO rev_sector (ID, descripcion) VALUES
(1, 'SEPULTURAS'),
(2, 'PALMERAS'),
(3, 'NICHERA'),
(4, 'CENIZARIO'),
(5, 'BOVEDA'),
(6, 'DEPOSITO');

-- INSERT SUB SECTORES
INSERT INTO rev_subsector (ID, sector, descripcion) VALUES
(1, 1, 'SEPULTURAS'),
(2, 1, 'INDIGENTES'),
(3, 2, 'PALMERAS ATAUD'),
(4, 2, 'PALMERAS CENIZAS'),
(5, 2, 'PALMERAS RESTOS'),
(6, 2, 'PALMERAS SEPULTURA'),
(7, 3, 'NICHERA'),
(8, 4, 'CENIZARIO'),
(9, 5, 'BOVEDA'),
(10, 6, 'DEPOSITO 1'),
(11, 6, 'DEPOSITO 2'),
(12, 6, 'DEPOSITO 3');